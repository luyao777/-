# 八分音符酱(人大联机版)
本项目参考[crossin教程](https://zhuanlan.zhihu.com/p/25499306)修改成多人联机版。

不要停八分音符酱(休むな!8分音符ちゃん♪)的游戏中，我们需要控制小人大表情跳来跳去，但玩法可就不那么容易了，因为它是依靠声音来操控游戏的。

游戏不仅需要你发声来控制人物，同时还得掌握好声音的力度。声嘶力竭大喊会让角色跳得非常高，而细细私语则只会令角色缓慢向前移动。而游戏中的障碍物都设计了许多“坑”，如果你想通关，那就只能拉下面子跟着游戏的节奏大呼小叫了。

## 玩法
用小的声音继续前进。

用大的声音跳跃。跳跃中发出声音前进。

用更大的声音更高跳跃。

跳跃中发出声音前进。

如果吃到药丸，可以获得意想不到的效果。

## 特色
岛国的宅男众多，所以游戏市场需求广泛，除了高质量的大作外，他们需要一些奇葩的小游戏缓解身心。现在，不少一款魔性十足的游戏在日本走红，而它就是2D动作游戏《八分音符酱》，其玩法十分简单，但上手后停不下来。

## 使用说明
#### 单机游戏使用说明
python game_single.py

#### 联机游戏使用说明
python game_server.py

python game_client.py 

可以修改game_server.py当中玩家数量来调节可以联机的玩家。

## 原理
本次实验使用了socket进行编程通信，套接字之间的连接过程可以分为三个部分：服务器监听，客户端请求，以及连接确认。

首先是服务器监听，服务器监听特定的端口，使服务器处在等待连接的状态。

其次是客户端请求，客户端向服务器发起连接请求，连接服务器端的套接字。客户端必须描述想要连接的服务器的IP地址以及端口，然后就可以向服务器发起连接请求。

最后是连接确认，当服务器端的套接字监听到客户端发起的连接请求，服务器会响应客户端的连接请求，建立一个新的线程，将服务器端套接字的描述发送给客户端，一旦客户端确认了这个描述，连接就建立成功。而服务器端套接字处于继续监听的状态，接续监听其他套接字的请求。

上述是服务器和客户端的连接过程，当服务器和客户端连接建立成功时，服务器会根据多人联机的玩家数量将不足的玩家进程挂起，直到满足数量的玩家连接成功时才会统一开始进行通信，每次有新的客户端连接请求进来时，服务器端都会向新的连接请求发送相同的随机数种子，用来确保所有客户端的游戏程序产生相同的游戏环境。

之后，客户端开始调用机器的录音设备来录制声音，并且实时提取音频的音量，并通过socket的连接向服务器实时传输音量流。服务器通过收集多个客户端的音量流，不断更新所有客户端实时发送的音量的平均值，实时返回到每个客户端。每个客户端通过服务器返回的音量，对玩家控制的人物进行控制，由此实现了多个客户端同时控制相同人物进行游戏。

